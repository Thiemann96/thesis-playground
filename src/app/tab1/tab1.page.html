<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [text]="back" defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Chen et. al.</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <div class="map-container">
    <div id="sidebar">
      <div class="sidebar-wrapper">
        <div id="features" class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Controls</h3>
          </div>
          <ion-list>
            <ion-list-header>
              <ion-label>
                Choose file
              </ion-label>
            </ion-list-header>

            <ion-item>
              <ion-label>Path file</ion-label>
              <ion-select (ionChange)="changePath($event)" placeholder="select One">
                <ion-select-option *ngFor="let option of selectOptions"  value="{{option}}">{{option}}</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-list>
          <ion-accordion-group>
            <ion-accordion>
              <ion-item slot="header">
                <ion-label>Stay point extraction</ion-label>
              </ion-item>
              <ion-list slot="content">
                <ion-item>
                  <ion-label>Time in Minutes:</ion-label>
                  <ion-input
                    (ionChange)="changeTimeThreshold($event)"
                    value="{{timeThreshold}}"
                    placeholder="time threshold"
                  >
                  </ion-input>
                </ion-item>
                <ion-item>
                  <ion-label>Distance in Meters:</ion-label>
                  <ion-input
                    (ionChange)="changeDist1Threshold($event)"
                    value="{{distance1Threshold}}"
                    placeholder="distance threshold"
                  ></ion-input>
                </ion-item>
                <ion-item>
                  <ion-button
                    color="success"
                    (click)="calculateStayPoints()"
                    size="small"
                  >
                    Stay point detection
                  </ion-button>
                </ion-item>
              </ion-list>
            </ion-accordion>
            <ion-accordion>
              <ion-item slot="header">
                <ion-label>Clustering</ion-label>
              </ion-item>
              <ion-list slot="content">
                <ion-item>
                  <ion-label>Distance in Meters:</ion-label>
                  <ion-input
                    (ionChange)="changeDist2Threshold($event)"
                    value="{{distance2Threshold}}"
                    placeholder="Distance threshhold"
                  ></ion-input>
                </ion-item>
                <ion-item>
                  <ion-button
                    color="success"
                    (click)="clusterOptics()"
                    expand="full"
                  >
                    Calculate OPTICS clusters
                  </ion-button>
                </ion-item>
                <ion-item>
                  <ion-button
                    color="success"
                    (click)="calculateClusters()"
                    expand="full"
                  >
                    Calculate DBSCAN
                  </ion-button>
                </ion-item>
              </ion-list>
            </ion-accordion>
          </ion-accordion-group>
          <div *ngIf="user" style="margin: 10px">
            <p>Messwerte Insgeamt: <b>{{this.allPoints.features.length}}</b></p>
            <p>Entdeckte Stay points: <b>{{stayPoints.length}}</b></p>
            <p *ngIf="countClusters">
              Entdeckte Cluster: <b>{{countClusters}}</b>
            </p>
          </div>
          <div *ngIf="arrayPerCluster">
            <ion-accordion-group>
              <ion-accordion
                *ngFor="let cluster of arrayPerCluster"
                value="{{cluster.clusterId}}"
              >
                <ion-item slot="header">
                  <ion-label
                    >Cluster: {{cluster.clusterId}} || Detected entities:
                    <ion-badge
                      *ngIf="cluster.hull.properties.osmInfo"
                      color="success"
                      >{{cluster.hull.properties.osmInfo.length}}</ion-badge
                    >
                  </ion-label>
                </ion-item>
                <ion-list slot="content">
                  <ion-item *ngIf="cluster.frequency">
                    <ion-label>
                      Frequency : {{cluster.frequency.T}} (every {{
                      cluster.frequency.T / 24 }} days)
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label
                      >Centroid: {{cluster.hull.geometry.coordinates[0][0]}}
                    </ion-label>
                  </ion-item>
                </ion-list>
              </ion-accordion>
            </ion-accordion-group>
          </div>
        </div>
      </div>
    </div>
    <div id="map"></div>
  </div>
  <!-- <ion-col>
        <div class="sidebar">
          <ion-row>
            <ion-col>

            </ion-col>
            <ion-col>
              <ion-card>
                <ion-card-title>Clusters</ion-card-title>
                <ion-item>
                  <ion-label>Distance in meters:</ion-label>
                  <ion-input (ionChange)="changeDist2Threshold($event)" value={{distance2Threshold}} placeholder="Distance threshhold"></ion-input>
                </ion-item>
                <ion-button
                  color="success"
                  (click)="calculateClusters()"
                  expand="full"
                >
                  Calculate clusters
                </ion-button>
              </ion-card>
            </ion-col>
          </ion-row>
        </div>
        <ion-progress-bar *ngIf="loading" type="indeterminate"></ion-progress-bar>
        <div *ngIf="user" class="sidebar">
          <ion-card *ngIf="user.filteredT">
            <ion-card-header>
              <ion-card-subtitle>
                Von {{user.filteredT[0][0].date.toLocaleString('de-DE', { timeZone:'Asia/Shanghai'}) }} bis {{user.filteredT[user.filteredT.length][0].date.toLocaleString('de-DE', { timeZone:'Asia/Shanghai'}) }} 
              </ion-card-subtitle>
              <ion-card-title>
                <p>
                  Messwerte Insgeamt: <b>{{this.allPoints.features.length}}</b>
                </p>
                <p>
                  Entdeckte Stay points: <b>{{stayPoints.length}}</b>
                </p>
                <p *ngIf="countClusters">
                  Entdeckte Cluster: <b>{{countClusters}}</b>
                </p>
              </ion-card-title>
            </ion-card-header>
          </ion-card>
          <div *ngIf="arrayPerCluster">
            <ion-accordion-group>
              <ion-accordion *ngFor="let cluster of arrayPerCluster" value="{cluster.clusterId}">
                <ion-item slot="header">
                  <ion-label [ngStyle]="{'color':cluster.stayPoints[0].properties.color}">Cluster ID: {{cluster.clusterId}} | No. staypoints: {{cluster.stayPoints.length}} | No. logs: {{cluster.pointsWithin.features.length}}</ion-label>
                </ion-item>
                <ion-list slot="content">
                  <ion-item>
                    <ion-label>Frequency : {{frequencies[cluster.clusterId].T}}</ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>OSM Info: Sports, ... </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-label>Centroid: {{cluster.hull.geometry.coordinates[0][0]}} </ion-label>
                  </ion-item>
                </ion-list>
              </ion-accordion>
            </ion-accordion-group>
          </div>
            <ion-card>
              <table>
                <tr>
                  <th>Cluster Id</th>
                  <th>Centroid</th>
                  <th>No. staypoints</th>
                  <th>No. logs</th>
                </tr>
                <tr *ngFor="let cluster of arrayPerCluster" [ngStyle]="{'color':cluster.stayPoints[0].properties.color}">
                  <td>{{cluster.clusterId}}</td>
                  <td>{{cluster.hull.geometry.coordinates[0][0]}}</td>
                  <td>{{cluster.stayPoints.length}} </td>
                  <td>{{cluster.pointsWithin.features.length}} </td>
                </tr>
              </table>
            </ion-card>
          </div>

        </div>
        
      </ion-col> -->
</ion-content>
